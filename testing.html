<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Manual Push Notification</title>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-messaging-compat.js"></script>
</head>
<body>
  <h2>Manual Web Push Notification</h2>
  <button id="notifyBtn" disabled>Send Notification</button>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDptVEqHvZqOF1deQrOpnhQI_w6Vb5n4zQ",
      authDomain: "watersystem-e444e.firebaseapp.com",
      databaseURL: "https://watersystem-e444e-default-rtdb.firebaseio.com",
      projectId: "watersystem-e444e",
      storageBucket: "watersystem-e444e.firebasestorage.app",
      messagingSenderId: "528910169669",
      appId: "1:528910169669:web:05c99d2ca2e6d8c069952c",
      measurementId: "G-H05MNY69J6"
    };

    firebase.initializeApp(firebaseConfig);
    const messaging = firebase.messaging();

    // ===== Register service worker =====
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('firebase-messaging-sw.js')
        .then(registration => {
          messaging.useServiceWorker(registration);
          console.log('Service Worker registered for FCM');
        }).catch(err => console.error('Service Worker registration failed:', err));
    }

    // ===== Ask permission and get token =====
    let fcmToken = '';
    const notifyBtn = document.getElementById('notifyBtn');

    Notification.requestPermission().then(permission => {
      if(permission === 'granted') {
        messaging.getToken({ vapidKey: 'BI9HCoP2mTvQuI24ZMbEWNhPJk4xoFumvhT7qaecz1gfprTTyIjWgPZqO_Zw4jh06f1iDD3JqkHnD9uxkVxDEGE' })
          .then(token => {
            console.log("FCM Token:", token);
            fcmToken = token;
            notifyBtn.disabled = false; // enable button
          })
          .catch(err => console.error("Error getting token:", err));
      } else {
        alert("Notifications blocked by user!");
      }
    });

    // ===== Click button to show notification =====
    notifyBtn.addEventListener('click', () => {
      if(!fcmToken) {
        alert("FCM token not ready yet!");
        return;
      }

      new Notification("Manual Alert", {
        body: "This notification was sent manually!",
        icon: "https://firebase.google.com/favicon.ico"
      });
    });
  </script>
</body>
</html>
